<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>freeline</title>
    <style>
        canvas {border:5px solid greenyellow;}
    </style>
</head>
<body>
            <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    <div>
        <img src="a.png" style="width:500px; height: 500px; float: left">
    </div>
    <div>
        <select id="color">
            <option value="black">검정</option>
            <option value="red">빨강</option>
            <option value="green">초록</option>
            <option value="blue">파랑</option>
        </select>
        <input type="button" id="clear" value="모두 지움"/>
    </div>

    <canvas id="canvas" width="600" height="400"></canvas>
    <script>
        var canvas;
        var ctx;
        var sx, sy;                      // 현재 위치
        var drawing = false;          // 현재 그리는 중인가?

        window.onload = function () {
            canvas = document.getElementById("canvas");
            if (canvas == null || canvas.getContext == null)
                return;
            ctx = canvas.getContext("2d");
            ctx.lineCap = "round";
            ctx.strokeStyle = 'black';
            // 현재 위치를 저장한다.
            canvas.onmousedown = function (e) {
                e.preventDefault();
                sx = canvasX(e.clientX);
                sy = canvasY(e.clientY);
                drawing = true;
            }

            // 현재 위치에서 새로 이동한 곳까지 선을 그린다.
            canvas.onmousemove = function (e) {
                
                if (drawing) {
                    e.preventDefault();
                    ctx.beginPath();

                    // 선 굵기
                    ctx.lineWidth = 4;
                    ctx.moveTo(sx, sy);
                    console.log('moveto sx:'+sx+"  sy:"+sy);
                    sx = canvasX(e.clientX);
                    sy = canvasY(e.clientY);
                    ctx.lineTo(sx, sy);
                    console.log('lineto sx:'+sx+"  sy:"+sy);
                    ctx.stroke();
                }
            }

            // 그리기를 종료한다.
            canvas.onmouseup = function (e) {
                drawing = false;
            }
        }


        $('#color').change(function (){
             ctx.strokeStyle = $('#color').val();
             console.log($('#color').val());
        })
        // 모두 지우기
        var btnclear = document.getElementById("clear");
        btnclear.onclick = function (e) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function canvasX(clientX) {
            var bound = canvas.getBoundingClientRect();
            var bw = 5;
            return (clientX - bound.left - bw) * (canvas.width / (bound.width - bw * 2));
        }

        function canvasY(clientY) {
            var bound = canvas.getBoundingClientRect();
            var bw = 5;
            return (clientY - bound.top - bw) * (canvas.height / (bound.height - bw * 2));
        }
    </script>
</body>
</html>